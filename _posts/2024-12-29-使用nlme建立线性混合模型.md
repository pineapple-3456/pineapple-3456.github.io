---
layout: post
title: 使用nlme建立线性混合模型
date: 2024-12-29 17:38:00
description: 使用nlme建立线性混合模型
tags: 心理学
categories:  
related_posts: true
---

## 线性混合模型介绍

社会科学研究中的数据经常具有层次结构，过去分析层次结构数据容易产生的一个问题是汇总偏差，即将不同组织的数据错误地纳入同一个模型中。例如对不同学校的学生的调查显示，学生的某种特质X可能会影响到学习成绩Y，然而X对Y的回归系数却不是恒定的，而是在不同学校间存在有统计意义的差异。线性混合模型的出现就是为了应对这种问题。应对的策略是允许X对Y的回归系数在一定范围内变化。

考虑以上的以上的例子，使用普通的ols回归可以建立回归方程：

$$
Y_i = \beta_0 + \beta_1X_i + e_i
$$

其中 $$i$$ 代表第 $$i$$ 个学生个体，而混合模型可以允许回归系数在不同学校间有差异，注意(3)和(4)的因变量是(2)的回归系数：

$$
\begin{align}
& Y_{ij} = \beta_{0j} + \beta_{1j}X_{ij} + r_{ij} \\
& \beta_{0j} = \gamma_{00} + u_{0j} \\
& \beta_{1j} = \gamma_{10} + u_{1j}
\end{align}
$$

其中 $$j$$ 表示第 $$j$$ 个学校， $$r_{ij}$$ 表示学生水平的误差， $$u_{0j}$$ 和 $$u_{1j}$$ 表示学校水平在截距和斜率上的误差，即不同学校间截距和斜率的差异。我们将第一行的方程称为层1，代表学生水平，将后两行的方程称为层2，代表学校水平。如果 $$\beta_0$$ 和 $$\beta_1$$ 还能够被学校特征W预测，那么普通ols回归方程为：

$$
Y_i = \beta_0 + \beta_1X_i + \beta_2W_j + \beta_3X_iW_j+ e_i
$$

线性混合模型的方程为：

$$
\begin{align}
& Y_{ij} = \beta_{0j} + \beta_{1j}X_{ij} + r_{ij} \\
& \beta_{0j} = \gamma_{00} + \gamma_{01}W_{j} + u_{0j} \\
& \beta_{1j} = \gamma_{10} + \gamma_{11}W_{j} + u_{1j}
\end{align}
$$

合并后的模型为：

$$
Y_{ij} = \gamma_{00} + \gamma_{10}X_{ij} + \gamma_{01}W_{j} + \gamma_{11}X_{ij}W_{j} + u_{0j} + u_{1j}X_{ij} + r_{ij} 
$$

对比普通ols回归方程，可以发现二者的区别在于原本的误差项 $$e_i$$ 变为 $$u_{0j}+u_{1j}X_{ij}+r_{ij}$$。实际上这正是线性混合模型与一般线性模型的主要区别：线性混合模型允许更加复杂的残差结构，这些残差依赖于 $$u_{0j}$$ 和 $$u_{1j}$$，因此在各学校中是不同的。线性混合模型中，残差被称为随机效应，其中 $$r_{ij}$$ 称为层1残差的随机效应， $$u_{0j}$$ 称为截距的随机效应， $$u_{1j}$$ 称为X的随机效应。相应地，固定效应则是合并模型(9)中的系数，其中 $$\gamma_{00}$$ 是截距的固定效应， $$\gamma_{10}$$ 是X的固定效应， $$\gamma_{01}$$ 是W的固定效应， $$\gamma_{11}$$ 是X和W交互项的固定效应。熟悉随机效应和固定效应的含义有助于理解nlme的公式设定和结果。

对于固定效应，我们关注的是它的系数，而对于随机效应，我们关注层2随机效应的方差和协方差，它们的作用可以在下节的实例中看到：

$$
\left.\mathrm{Var}\left[
\begin{array}
{c}u_{0j} \\
 \\
u_{1j}
\end{array}\right.\right]=
\begin{bmatrix}
\tau_{00} & \tau_{01} \\
 \\
\tau_{10} & \tau_{11}
\end{bmatrix}
$$


